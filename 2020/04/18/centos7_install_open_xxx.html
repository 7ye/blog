<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><title>centos7 搭建 openvpn 服务器（使用账号和密码方式） - sevennight</title><meta name="description" content="openvpn是一款提供与企业与个人之间创建虚拟专用网络安全数据传输通道的软件，可以搭建类似局域网的专用通道最近因公司需要远程访问客户的一种设备，但他们不想公开开放，但他们设备有一个openvpn配置项，所以就研究了下，搭建完记录下环境：openvpn服务器系统版本 CentOS Linux rel"><link type="text/css" rel="stylesheet" href="/css/pure.css?v=0.0.1"><link type="text/css" rel="stylesheet" href="/css/style.css?v=0.0.1"><script type="text/javascript" src="//cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head></html><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">centos7 搭建 openvpn 服务器（使用账号和密码方式）</h1><a id="logo" href="/.">sevennight</a></div><div id="nav-menu"><div class="bitcron_nav"><div class="site_nav_wrap"><div class="site_nav"><span class="a_container"><a href="/." class="selected active current">首页</a></span><span class="a_container"><a href="/archives/">归档</a></span><span class="a_container"><a href="/about/">关于</a></span><span class="a_container"><a href="/guestbook/">留言</a></span></div></div></div></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">centos7 搭建 openvpn 服务器（使用账号和密码方式）</h1><div class="post-meta">2020-04-18<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" type="text/javascript"></script><span class="meta-space">  |  </span><span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span><span> 浏览</span></span></div><!--文章内容--><div class="post-content"><p>openvpn是一款提供与企业与个人之间创建虚拟专用网络安全数据传输通道的软件，可以搭建类似局域网的专用通道</p>
<p>最近因公司需要远程访问客户的一种设备，但他们不想公开开放，但他们设备有一个openvpn配置项，所以就研究了下，搭建完记录下</p>
<p>环境：<br>openvpn服务器系统版本 CentOS Linux release 7.6.1810 (Core)<br>客户端连接软件安装在windows10</p>
<p>搭建及要实现的内容如下：<br>1、server端和client端的安装和配置<br>2、配置防火墙及路由转发<br>3、配置账号密码验证，给账号分配固定IP，且用户连接与断开实时调用后续处理脚本</p>
<h2 id="一、制作证书"><a href="#一、制作证书" class="headerlink" title="一、制作证书"></a>一、制作证书</h2><p>安装<code>easy-rsa</code>和<code>openvpn</code>软件包</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> openvpn easy-rsa</span><br></pre></td></tr></table></figure>
<p>复制相关文件</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注意easy-rsa的版本号，你的有可能不一样</span></span><br><span class="line">cp <span class="meta-keyword">/usr/</span>share<span class="meta-keyword">/doc/</span>easy-rsa<span class="number">-3.0</span><span class="number">.7</span>/vars.example <span class="meta-keyword">/etc/</span>openvpn<span class="meta-keyword">/easy-rsa/</span>vars</span><br><span class="line">cp -r /usr</span><br></pre></td></tr></table></figure>
<p>/share/easy-rsa/3.0.7/* /etc/openvpn/easy-rsa/</p>
<p>编辑vars文件，修改如下选项（此步骤为可选操作，使用默认的也是可以的）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/openvpn/easy-rsa/vars</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">set_var EASYRSA_REQ_COUNTRY    <span class="string">"US"</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">set_var EASYRSA_REQ_PROVINCE   <span class="string">"California"</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">set_var EASYRSA_REQ_CITY       <span class="string">"San Francisco"</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">set_var EASYRSA_REQ_ORG        <span class="string">"Copyleft Certificate Co"</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">set_var EASYRSA_REQ_EMAIL      <span class="string">"me@example.net"</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">set_var EASYRSA_REQ_OU         <span class="string">"My Organizational Unit"</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">修改公司、邮箱、国家等信息，大约250行附近</span></span><br></pre></td></tr></table></figure>
<p>初始化证书目录</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> <span class="string">/etc/openvpn/easy-rsa/</span></span><br><span class="line"><span class="string">./easyrsa</span> init-pki</span><br></pre></td></tr></table></figure>
<p>创建CA根证书</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">./easyrsa</span> build-ca</span><br><span class="line"><span class="comment">#需输入两次密码和一次名称，或者不设置直接都回车</span></span><br></pre></td></tr></table></figure>
<p>创建服务器端证书，执行命令一路回车</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./easyrsa gen-req<span class="built_in"> server </span>nopass</span><br><span class="line"><span class="comment">#一路回车即可</span></span><br></pre></td></tr></table></figure>
<p>签署服务器端证书</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./easyrsa sign<span class="built_in"> server </span>server</span><br><span class="line"><span class="comment"># 回车后输入yes，还需输入之前创建CA根证书设置的密码，如未设置直接回车</span></span><br></pre></td></tr></table></figure>
<p>生成加密交换时的Diffie-Hellman文件，会生成一个pem后缀文件，生成过程比较慢</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">./easyrsa</span> gen-dh</span><br></pre></td></tr></table></figure>
<h2 id="2、配置openvpn服务端"><a href="#2、配置openvpn服务端" class="headerlink" title="2、配置openvpn服务端"></a>2、配置openvpn服务端</h2><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">vi <span class="meta-keyword">/etc/</span>openvpn/server.conf</span><br><span class="line"></span><br><span class="line"><span class="meta"># 以下配置可直接复制</span></span><br><span class="line"></span><br><span class="line">port <span class="number">1194</span></span><br><span class="line">proto tcp</span><br><span class="line">dev tun</span><br><span class="line"></span><br><span class="line"><span class="meta"># 相关证书配置路径</span></span><br><span class="line">ca <span class="meta-keyword">/etc/</span>openvpn<span class="meta-keyword">/easy-rsa/</span>pki/ca.crt</span><br><span class="line">cert <span class="meta-keyword">/etc/</span>openvpn<span class="meta-keyword">/easy-rsa/</span>pki<span class="meta-keyword">/issued/</span>server.crt</span><br><span class="line">key <span class="meta-keyword">/etc/</span>openvpn<span class="meta-keyword">/easy-rsa/</span>pki<span class="meta-keyword">/private/</span>server.key</span><br><span class="line">dh <span class="meta-keyword">/etc/</span>openvpn<span class="meta-keyword">/easy-rsa/</span>pki/dh.pem</span><br><span class="line"></span><br><span class="line">server <span class="number">10.8</span><span class="number">.0</span><span class="number">.0</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span>    <span class="meta"># 虚拟网段</span></span><br><span class="line"></span><br><span class="line">client-to-client    <span class="meta"># 客户端互通</span></span><br><span class="line">keepalive <span class="number">10</span> <span class="number">120</span></span><br><span class="line">comp-lzo</span><br><span class="line"></span><br><span class="line">cipher AES<span class="number">-256</span>-CBC</span><br><span class="line">persist-key</span><br><span class="line">persist-tun</span><br><span class="line"></span><br><span class="line">status logs/openvpn-status.log  <span class="meta"># 状态日志路径</span></span><br><span class="line">log-append logs/openvpn.log     <span class="meta"># 运行日志</span></span><br><span class="line">verb <span class="number">3</span>                          <span class="meta"># 调试信息级别</span></span><br><span class="line"></span><br><span class="line">client-config-dir <span class="meta-keyword">/etc/</span>openvpn/ccd  <span class="meta"># 固定IP分配配置目录，见下面讲解</span></span><br><span class="line"></span><br><span class="line">script-security <span class="number">2</span></span><br><span class="line">auth-user-pass-verify <span class="meta-keyword">/etc/</span>openvpn/checkpwd.sh via-file    <span class="meta"># 密码验证脚本</span></span><br><span class="line">username-as-common-name</span><br><span class="line">verify-client-cert none</span><br><span class="line"></span><br><span class="line"><span class="meta"># client-connect /etc/openvpn/scripts/connect.sh           # 新连接连接时执行脚本</span></span><br><span class="line"><span class="meta"># client-disconnect /etc/openvpn/scripts/disconnect.sh     # 有连接退出时执行脚本</span></span><br></pre></td></tr></table></figure>
<p>创建用户账号和密码的配置</p>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">touch /etc/openvpn/<span class="keyword">pwd</span>-<span class="keyword">file</span></span><br><span class="line">vi /etc/openvpn/<span class="keyword">pwd</span>-<span class="keyword">file</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件内容为</span></span><br><span class="line"><span class="comment"># 每一行代表一个用户，账号和密码以空格分开</span></span><br><span class="line">client1 <span class="number">123456</span></span><br><span class="line">client2 <span class="number">123456</span></span><br><span class="line">client3 <span class="number">123456</span></span><br></pre></td></tr></table></figure>
<p>给用户client1分配固定IP为10.8.0.57</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mkdir <span class="meta-keyword">/etc/</span>openvpn/ccd</span><br><span class="line">cd  <span class="meta-keyword">/etc/</span>openvpn/ccd</span><br><span class="line"></span><br><span class="line"><span class="meta"># 文件名称需以用户账号命名</span></span><br><span class="line">touch <span class="meta-keyword">/etc/</span>openvpn<span class="meta-keyword">/ccd/</span>client1</span><br><span class="line">vi <span class="meta-keyword">/etc/</span>openvpn<span class="meta-keyword">/ccd/</span>client1</span><br><span class="line"></span><br><span class="line"><span class="meta">#文件内容</span></span><br><span class="line">ifconfig-push <span class="number">10.8</span><span class="number">.0</span><span class="number">.57</span> <span class="number">10.8</span><span class="number">.0</span><span class="number">.58</span></span><br></pre></td></tr></table></figure>
<p>创建密码验证脚本<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">touch /etc/openvpn/checkpwd.sh</span><br><span class="line">chmod +x checkpwd.sh</span><br><span class="line">vi /etc/openvpn/checkpwd.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 脚本内容</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">PASSFILE=<span class="string">"/etc/openvpn/pwd-file"</span></span><br><span class="line">LOG_FILE=<span class="string">"/etc/openvpn/logs/openvpn-password.log"</span></span><br><span class="line">TIME_STAMP=`date <span class="string">"+%Y-%m-%d %T"</span>`</span><br><span class="line"></span><br><span class="line"><span class="built_in">readarray</span> -t lines &lt; <span class="variable">$1</span></span><br><span class="line">username=<span class="variable">$&#123;lines[0]&#125;</span></span><br><span class="line">password=<span class="variable">$&#123;lines[1]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -r <span class="string">"<span class="variable">$&#123;PASSFILE&#125;</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;TIME_STAMP&#125;</span>: Could not open password file \"<span class="variable">$&#123;PASSFILE&#125;</span>\" for reading."</span> &gt;&gt; <span class="variable">$&#123;LOG_FILE&#125;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">CORRECT_PASSWORD=`awk <span class="string">'!/^;/&amp;&amp;!/^#/&amp;&amp;$1=="'</span><span class="variable">$&#123;username&#125;</span><span class="string">'"&#123;print $2;exit&#125;'</span> <span class="variable">$&#123;PASSFILE&#125;</span>`</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;CORRECT_PASSWORD&#125;</span>"</span> = <span class="string">""</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;TIME_STAMP&#125;</span>: User does not exist: username=\"<span class="variable">$&#123;username&#125;</span>\", password=\"<span class="variable">$&#123;password&#125;</span>\"."</span> &gt;&gt; <span class="variable">$&#123;LOG_FILE&#125;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;password&#125;</span>"</span> = <span class="string">"<span class="variable">$&#123;CORRECT_PASSWORD&#125;</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;TIME_STAMP&#125;</span>: Successful authentication: username=\"<span class="variable">$&#123;username&#125;</span>\"."</span> &gt;&gt; <span class="variable">$&#123;LOG_FILE&#125;</span></span><br><span class="line">  <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;TIME_STAMP&#125;</span>: Incorrect password: username=\"<span class="variable">$&#123;username&#125;</span>\", password=\"<span class="variable">$&#123;password&#125;</span>\"."</span> &gt;&gt; <span class="variable">$&#123;LOG_FILE&#125;</span></span><br><span class="line"><span class="built_in">exit</span> 1</span><br></pre></td></tr></table></figure></p>
<p>（可选配置）争对client-connect和client-disconnect这两个配置这里就不多说了，可能对大多数人用处不大，我的业务是有用户连接上了，就调用脚本向远程http接口通知我们系统有客户连接上了然后去做业务处理的，我把大致脚本发出来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">connect.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 脚本内容</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">" 发现新连接 &gt;&gt;&gt;&gt;&gt; 账号: <span class="variable">$&#123;common_name&#125;</span> 分配IP: <span class="variable">$&#123;trusted_ip&#125;</span> 连接者IP: <span class="variable">$&#123;ifconfig_pool_remote_ip&#125;</span>"</span></span><br><span class="line"><span class="comment"># 上报到远程接口，使用curl等工具...</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure>
<p>开启内核路由转发功能</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo <span class="string">"net.ipv4.ip_forward = 1"</span> <span class="meta">&gt;&gt;</span>/etc/sysctl.conf</span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>
<p>配置防火墙</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开放tcp 1194端口</span></span><br><span class="line">firewall-<span class="keyword">cmd</span><span class="bash"> --zone=public --add-port=1194/tcp --permanent</span></span><br><span class="line"><span class="bash"><span class="comment"># 重新加载防火墙使其生效</span></span></span><br><span class="line"><span class="bash">firewall-cmd --reload</span></span><br><span class="line"><span class="bash"><span class="comment"># 查看防火墙规则是否配置成功</span></span></span><br><span class="line"><span class="bash">firewall-cmd --list-all</span></span><br></pre></td></tr></table></figure>
<p>启动openvpn服务器</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">openvpn /etc/openvpn/<span class="keyword">server</span>.conf &amp;</span><br><span class="line">或者</span><br><span class="line">systemctl start openvpn@<span class="keyword">server</span>    <span class="meta"># 启动服务</span></span><br><span class="line">systemctl status openvpn@<span class="keyword">server</span>   <span class="meta"># 查看状态</span></span><br><span class="line">systemctl stop openvpn@<span class="keyword">server</span>     <span class="meta"># 停止服务</span></span><br></pre></td></tr></table></figure>
<p>执行start启动服务命令后，使用status命令查询状态，如果<code>Active: failed</code>，请到<code>/etc/openvpn/logs/openvpn.log</code>目录下查看日志，基本打印的错误消息挺全的，可借此排查错误，另外记得如果开启了防火墙要把openvpn配置的端口开放，并且有的服务商还在他们自己控制台有安全策略，如果服务启动了连接很久都连接不上可以往这些方面思考一下</p>
<h2 id="配置openvpn客户端"><a href="#配置openvpn客户端" class="headerlink" title="配置openvpn客户端"></a>配置openvpn客户端</h2><p>创建配置文件</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">cd <span class="meta-keyword">/root/</span></span><br><span class="line">touch client.ovpn</span><br><span class="line">vi <span class="meta-keyword">/etc/</span>openvpn<span class="meta-keyword">/easy-rsa/</span>pki/ca.crt    <span class="meta"># 复制所有内容</span></span><br><span class="line">vi <span class="meta-keyword">/root/</span>client.ovpn </span><br><span class="line"></span><br><span class="line"><span class="meta"># client.ovpn文件内容</span></span><br><span class="line">client </span><br><span class="line">dev tun </span><br><span class="line">proto tcp </span><br><span class="line">remote <span class="number">193.112</span>.xxx.xxx <span class="number">1194</span>    <span class="meta"># openvpn远程服务器的IP和端口</span></span><br><span class="line">resolv-retry infinite </span><br><span class="line">nobind </span><br><span class="line">persist-key </span><br><span class="line">persist-tun </span><br><span class="line">cipher AES<span class="number">-256</span>-CBC </span><br><span class="line">comp-lzo </span><br><span class="line">verb <span class="number">3</span> </span><br><span class="line">auth-user-pass     <span class="meta"># 添加此配置客户端连接时会弹出密码框</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 证书配置</span></span><br><span class="line"><span class="params">&lt;ca&gt;</span></span><br><span class="line"><span class="meta">#此处粘贴刚才在/etc/openvpn/easy-rsa/pki/ca.crt复制的内容</span></span><br><span class="line"><span class="params">&lt;/ca&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后导出<code>client.ovpn</code>文件，导入到客户端里进行连接</p>
<p>openvpn客户端官方下载连接<br><a href="https://openvpn.net/community-downloads/" target="_blank" rel="noopener">https://openvpn.net/community-downloads/</a></p>
<p>下载安装时注意如果弹出要安装<code>TAP-Windows Provider V9</code>的东西一定要通过，不然安装成功了，连接时还是无法连接</p>
<p>客户端<br><img src="/image/1587143697591.png" alt="Alt text"></p>
<p>启动客户端软件，然后在任务栏有一个像电脑显示器的小图标右键选择导入配置文件<br><img src="/image/1587143802423.png" alt="Alt text"></p>
<p>连接<br><img src="/image/1587143950209.png" alt="Alt text"></p>
<p>在弹出的密码框里输入我们在服务端<code>pwd-file</code>文件里配置的用户名和密码<br><img src="/image/1587144012062.png" alt="Alt text"></p>
<p>连接成功，且IP也是成功分配到我们配置的IP<br><img src="/image/1587144242918.png" alt="Alt text"></p>
<p>一些有帮助的文章：<br><a href="https://i4t.com/4481.html" target="_blank" rel="noopener">https://i4t.com/4481.html</a><br><a href="https://my.oschina.net/stache/blog/1512610" target="_blank" rel="noopener">https://my.oschina.net/stache/blog/1512610</a><br><a href="http://blog.leanote.com/post/mrnice/openvpn%E6%90%AD%E5%BB%BA" target="_blank" rel="noopener">http://blog.leanote.com/post/mrnice/openvpn%E6%90%AD%E5%BB%BA</a></p>
</div><!--文章标签--><div class="tags"><a href="/tags/linux/">linux</a><a href="/tags/openvpn/">openvpn</a></div><!--评论--><div id="disqus_thread"><script>var disqus_shortname = 'sevennight';
var disqus_identifier = '2020/04/18/centos7_install_open_xxx.html';
var disqus_title = 'centos7 搭建 openvpn 服务器（使用账号和密码方式）';
var disqus_url = 'https://sevennight.cc/2020/04/18/centos7_install_open_xxx.html';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><!--script(id='dsq-count-scr', src='//#{theme.disqus}.disqus.com/count.js', async)--></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" id="search" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://sevennight.cc"/></form></div><div class="widget"><div class="widget-title"> 分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端开发/">前端开发</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/后台开发/">后台开发</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/学习笔记/">学习笔记</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/走走看看/">走走看看</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/路上/">路上</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"> 标签</div><div class="tagcloud"><a href="/tags/程序设计/" style="font-size: 12px;">程序设计</a> <a href="/tags/linux/" style="font-size: 12px;">linux</a> <a href="/tags/openvpn/" style="font-size: 12px;">openvpn</a> <a href="/tags/java/" style="font-size: 18px;">java</a> <a href="/tags/Hexo/" style="font-size: 12px;">Hexo</a> <a href="/tags/设计模式/" style="font-size: 12px;">设计模式</a> <a href="/tags/javascript/" style="font-size: 12px;">javascript</a> <a href="/tags/html5/" style="font-size: 12px;">html5</a></div></div><div class="widget"><div class="widget-title"> 最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/04/18/centos7_install_open_xxx.html">centos7 搭建 openvpn 服务器（使用账号和密码方式）</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/17/yougan.html">有感</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/25/hexo_theme_maupassant_share.html">Hexo简洁主题推荐分享</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/16/integer_and_int_compare.html">Integer与int的种种比较</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/12/understand_clone_use.html">理解clone()方法如何使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/30/localStorage_css_and_js.html">将静态文件缓存到html5的localStorage，给网站加速</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/07/19/auto_login_impl.html">使用token实现在有效期内APP自动登录功能</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/12/java_design_pattern_singleton.html">Java设计模式之 - 单例模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/01/constructor_whether_can_override.html">构造器Constructor是否可被Override？</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/10/25/java_polymorphism_understand.html">Java三大特性之多态</a></li></ul></div><div class="widget"><div class="widget-title"> 友情链接</div><ul class="links-list"><li class="links-list-item"><a href="https://10coo.com" title="拾果收藏夹" target="_blank">拾果收藏夹</a></li></ul></div></div></div></div><div id="footer">© <a href="/." rel="nofollow">sevennight.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a> Theme<a target="_blank" href="https://github.com/7ye/maupassant-hexo"> Maupassant.</a></div><a id="back_to_top" href="javascript:void(0)" class="back_to_top"><span>△</span></a><script type="text/javascript" src="/js/totop.js?v=0.0.1"></script><link rel="stylesheet" href="/css/jquery.fancybox.css"><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1"></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?c5661531246743ef9eef42e7f80a616b";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script>function auto_code_fit(){
  if($(".highlight").length != 0){
    var pc_width = $(".post-content").width();
    $(".highlight .code").find("pre").width((pc_width-70)+"px");
  }
}
window.onresize = function(){
  auto_code_fit();
}
auto_code_fit();</script></div></body>